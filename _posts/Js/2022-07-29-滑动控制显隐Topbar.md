---
layout: post
filename: 2022-07-29-滑动控制显隐Topbar
title: 滑动控制显隐Topbar
date: 2022-07-29 23:17:53 +0800
categories: IntersectionObserver
tags: topbar IntersectionObserver
---

需求概述: 要实现页面往下滑动时顶部导航透明度逐渐消失，往上滑动快到顶部了又显示出来；

思路: 利用 [IntersectionObserver][1] 这个API; 做一个不响应事件的透明块，检测它的滑动位置，动态改变Topbar的透明度

代码实现：

html

```html
<div class="topbar">我是Topbar</div>
<div class="topbar_shadow"></div>
<div class="box">
    内容...
</div>
```

css

```css
.topbar {
    position: fixed;
    left: 0;
    top: 0;
    right: 0;
    height: 70px;
    z-index: 3;
    background-color: rgba(23, 224, 211, 0.6);
    transition: opacity 0.1s;
}

.topbar_shadow {
    position: absolute;
    left: 0;
    top: 200px;
    right: 0;
    height: 210px;
    z-index: 1;
    pointer-events: none;
    background-color: transparent;
}

.box {
    height: 2000px;
    background-color: #999;
}
```

js

```javascript
var $ = function(sel) {
    return document.querySelectorAll(sel)
}

const thresholdArray = steps => Array(steps + 1)
    .fill(0)
    .map((_, index) => index / steps || 0)
console.log("thresholdArray(20) ===>", thresholdArray(20));

const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
        const op = entry.intersectionRatio;
        $(".topbar")[0].style.opacity = op;
    });
}, {
    threshold: thresholdArray(20),
});

observer.observe($(".topbar_shadow")[0])
```
[在线Demo](https://codepen.io/zaptun/pen/abYVQQN)

[1]: https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API