---
layout: post
filename: 2023-02-10-Varlet组件库
title: Varlet组件库
date: 2023-02-10 21:06:30 +0800
categories: 
tags: 
---

### 支持docs的子集目录

主要是修改 varlet-cli 构建库

1. 增加子目录识别
主要修改文件 `packages/varlet-cli/src/node/compiler/compileSiteEntry.ts`

* 修改 *findRootDocs* 方法，`*.md` 改成 `**/*.md`
```typescript
export function findRootDocs(): Promise<string[]> {
    return glob(`${ROOT_DOCS_DIR}/**/*.md`);
}
```

* 修改 25 行 正则匹配中，正则
```typescript
const ROOT_DOCS_RE = /\/docs\/([-\w]+)\.([-\w]+)\.md/
为
const ROOT_DOCS_RE = /\/docs\/([-\w]+\/)?([-\w]+)\.([-\w]+)\.md/;
```

* 修改 *getRootDocRoutePath* 方法，自定义 path
```typescript
export function getRootDocRoutePath(rootDocsPath: string): string {
    const [, catalogPath,routePath, language] = rootDocsPath.match(ROOT_DOCS_RE) ?? [];
    return `/${language}/${catalogPath ? catalogPath + routePath : routePath}`;
}
```

2. 自定义标题，在md文件头部添加如下代码
```shell
    ```yaml
    meta:
    type: 开发指南
    title: 快速上手
    description: 跟随以下的步骤，快速上手组件库的使用。
    ```
```

3. 给 path 增加 name
```typescript
const componentDocsRoutes = componentDocs.map(
    (componentDoc) => `
    {
    path: '${getComponentDocRoutePath(componentDoc)}',
    // @ts-ignore
    name: '${getComponentDocRoutePath(componentDoc).replace(/\//g,'_')}',
    component: () => import('${componentDoc}')
    }`
);

const rootDocsRoutes = rootDocs.map(
    (rootDoc) => `
    {
    path: '${getRootDocRoutePath(rootDoc)}',
    // @ts-ignore
    name: '${getRootDocRoutePath(rootDoc).replace(/\//g,'_')}',
    component: () => import('${rootDoc}')
    }`
);
```

### md文件引入图片
直接写  '/logo.svg' , 文件在  `packages/varlet-ui/public/logo.svg`
```html
<img src="/logo.svg" alt="webstorm setting" />
```