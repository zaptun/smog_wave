## 证书学习

### 1. 证书格式介绍

PKCS 全称是 Public-Key Cryptography Standards ，是由 RSA 实验室与其它安全系统开发商为促进公钥密码的发展而制订的一系列标准，PKCS 目前共发布过 15 个标准。 常用的有

对于 X.509 标准的证书有两种不同编码格式,一般采用 PEM 编码就以 .pem 作为文件扩展名,若采用 DER 编码，就应以 .der 作为扩展名。但常见的证书扩展名还包括 .crt、.cer、.p12 等，他们采用的编码格式可能不同，内容也有所差别，但大多数都能互相转换，总结如下：

1. .pem: 采用 PEM 编码格式的 X.509 证书的文件扩展名；

2. .der : 采用 DER 编码格式的 X.509 证书的文件扩展名；

3. .crt : 即 certificate 的缩写，常见于类 UNIX 系统，有可能是 PEM 编码，也有可能是 DER 编码，但绝大多数情况下此格式证书都是采用 PEM 编码；

4. .cer: 也是 certificate 的缩写，常见于 Windows 系统，同样地，可能是 PEM 编码，也可能是 DER 编码，但绝大多数情况下此格式证书都是采用 DER 编码

5. .p12: 也写作 .pfx，全称：PKCS #12，是公钥加密标准（Public Key Cryptography Standards，PKCS）系列的一种，它定义了描述个人信息交换语法（Personal Information Exchange Syntax）的标准，可以用来将包含了公钥的 X.509 证书和证书对应的私钥以及其他相关信息打包，进行交换。简单理解：一份.p12文件 =  X.509证书 + 私钥；

6. .csr: Certificate Signing Request 的缩写，即证书签名请求，它并不是证书的格式，而是用于向权威证书颁发机构（Certificate Authority, CA）获得签名证书的申请，其核心内容包含一个 RSA 公钥和其他附带信息，在生成这个 .csr 申请的时候，同时也会生成一个配对 RSA 私钥，私钥通常需要严格保存于服务端，不能外泄。

7. .key: 通常用来存放一个 RSA 公钥或者私钥，它并非 X.509 证书格式，编码同样可能是 PEM，也可能是 DER，查看方式如下：

8. PEM 编码格式：openssl rsa -in xxx.key -text -noout

9. DER 编码格式：openssl rsa -in xxx.key -text -noout -inform der




### 2. 证书生成与转换

打开终端，敲入命令即可转换

```shell
//p12生成证书
openssl pkcs12 -clcerts -nokeys -out apple_cert.pem -in apple_cert.p12

//p12导出key，这时需要输入p12的导出密码
openssl pkcs12 -nocerts -nodes -out apple.key -in apple_cert.p12


//利用key导出公私钥（存在rsa和ecc算法两种）：

    //导出rsa公私钥
    openssl rsa -in apple.key -out apple_rsa_pri.pem
    openssl rsa -in apple.key -pubout -out apple_rsa_pub.pem

    //导出ecc公私钥
    openssl ec -in apple.key -out apple_ec_pri.pem
    openssl ec -in apple.key -pubout -out apple_ec_pub.pem

//一般服务端只需要证书和私钥，所以拼接即可：
cat apple_cert.pem apple_rsa_pri.pem >magic-dev.pem
//或者
cat apple_cert.pem apple_ec_pri.pem >magic-dev.pem

//将p12证书文件转换成pem证书文件,提示输入密码，就是p12的导出密码。
openssl pkcs12 -in  Cert.p12 -out Cert.pem -nodes //方法1
openssl pkcs12 -nocerts -nodes -in cert.p12 -out private.pem   //方法2
//验证  
openssl pkcs12 -clcerts -nokeys -in cert.p12 -out cert.pem

//将pem证书文件转换成p12证书文件
openssl pkcs12 -export -in Cert.pem -out Cert.p12
openssl pkcs12 -export -in Cert.pem -out Cert.p12 -inkey key.pem
openssl pkcs12 -export -in Cert.pem -out Cert.p12 -nokeys   //不指定key文件

//Cer格式文件转化pem
openssl x509 -inform der -in cert.cer -out cert.pem

//从 PFX 格式文件中提取私钥格式文件 (.key)
openssl pkcs12 -in mycert.pfx -nocerts -nodes -out mycert.key

//转换 pem 到到 spc
openssl crl2pkcs7 -nocrl -certfile venus.pem  -outform DER -out venus.spc

//用 -outform -inform 指定 DER 还是 PAM 格式。例如：
openssl x509 -in Cert.pem -inform PEM -out cert.der -outform DER

//用spc生成 p12
openssl pkcs7 -inform DER -in 18fca4b6bb54298-SHA2.spc -outform PEM -out out.p12
```

### 3. 常用方法

```shell
//1、生成RSA密钥的方法 
openssl genrsa -des3 -out privkey.pem 2048 
//这个命令会生成一个2048位的密钥，同时有一个des3方法加密的密码，如果你不想要每次都输入密码，可以改成： 
openssl genrsa -out privkey.pem 2048 
//建议用2048位密钥，少于此可能会不安全或很快将不安全。 

//2、生成一个证书请求 
openssl req -new -key privkey.pem -out cert.csr 
//这个命令将会生成一个证书请求，当然，用到了前面生成的密钥privkey.pem文件 
//这里将生成一个新的文件cert.csr，即一个证书请求文件，你可以拿着这个文件去数字证书颁发机构（即CA）申请一个数字证书。CA会给你一个新的文件cacert.pem，那才是你的数字证书。 

//如果是自己做测试，那么证书的申请机构和颁发机构都是自己。就可以用下面这个命令来生成证书： 
openssl req -new -x509 -key privkey.pem -out cacert.pem -days 1095 
//这个命令将用上面生成的密钥privkey.pem生成一个数字证书cacert.pem 

//3、使用数字证书和密钥 
//有了privkey.pem和cacert.pem文件后就可以在自己的程序中使用了，比如做一个加密通讯的服务器

```



1. CA证书

用openssl创建CA证书的RSA密钥(PEM格式)：

openssl genrsa -des3 -out ca.key 1024

2. 创建CA证书有效期为一年

用openssl创建CA证书(PEM格式,假如有效期为一年)：

openssl req -new -x509 -days 365 -key ca.key -out ca.crt -config openssl.cnf

openssl是可以生成DER格式的CA证书的，最好用IE将PEM格式的CA证书转换成DER格式的CA证书。

3. x509转换为pfx

openssl pkcs12 -export -out server.pfx -inkey server.key -in server.crt

4. PEM格式的ca.key转换为Microsoft可以识别的pvk格式

pvk -in ca.key -out ca.pvk -nocrypt -topvk

5. PKCS#12 到 PEM 的转换

openssl pkcs12 -nocerts -nodes -in cert.p12 -out private.pem 验证  openssl pkcs12 -clcerts -nokeys -in cert.p12 -out cert.pem

6. 从 PFX 格式文件中提取私钥格式文件 (.key)

openssl pkcs12 -in mycert.pfx -nocerts -nodes -out mycert.key

7. 转换 pem 到到 spc

openssl crl2pkcs7 -nocrl -certfile venus.pem -outform DER -out venus.spc

用 -outform -inform 指定 DER 还是 PAM 格式。例如：

openssl x509 -in Cert.pem -inform PEM -out cert.der -outform DER

8. PEM 到 PKCS#12 的转换

openssl pkcs12 -export -in Cert.pem -out Cert.p12 -inkey key.pem



### 4. IIS 证书

```shell
cd c:\openssl set OPENSSL_CONF=openssl.cnf 　　　　　　　　　 
openssl pkcs12 -export -out server.pfx -inkey server.key -in server.crt
```

server.key和server.crt文件是Apache的证书文件，生成的server.pfx用于导入IIS



**How to Convert PFX Certificate to PEM Format for SOAP**

```shell
$ openssl pkcs12 -in test.pfx -out client.pem Enter Import Password: MAC verified OK Enter PEM pass phrase: Verifying - Enter PEM pass phrase:
```

### 5. IOS开发 把cer证书转为p12证书

在 Mac OS 上将 iPhone 开发人员证书转换为 P12 文件

从 Apple 下载 Apple iPhone 证书后，将其导出为 P12 证书格式。在 Mac? OS 上执行以下操作：

打开钥匙串访问应用程序（位于应用程序/实用工具文件夹中）。

如果尚未将该证书添加到钥匙串，请选择“文件”>“导入”。然后浏览到您从 Apple 获取的证书文件（.cer 文件）。

在钥匙串访问中选择密钥类别。

选择与 iPhone 开发证书相关联的私钥。

该私钥由 iPhone 开发人员识别：与之配对的<名字><姓氏>公共证书。

选择“文件”>“导出项目”。

以个人信息交换 (.p12) 文件格式保存您的密钥。

系统将提示您创建一个尝试在其他计算机上导入此密钥时需要使用的密码。

在 Windows 上将 Apple 开发人员证书转换为 P12 文件

要使用 Flash CS5 开发 iPhone 应用程序，则必须使用 P12 证书文件。基于从 Apple 收到的 Apple iPhone 开发人员证书文件生成此证书。



将从 Apple 收到的开发人员证书文件转换成 PEM 证书文件。从 OpenSSL bin 目录运行以下命令行语句：

```shell
openssl x509 -in developer_identity.cer -inform DER -out developer_identity.pem -outform PEM
```



如果您使用的是 Mac 计算机上钥匙串中的私钥，则将其转换成 PEM 密钥：

```shell
openssl pkcs12 -nocerts -in mykey.p12 -out mykey.pem
```



现在，您可以基于密钥和 PEM 版本的 iPhone 开发人员证书生成有效的 P12 文件：

```shell
openssl pkcs12 -export -inkey mykey.key -in developer_identity.pem -out iphone_dev.p12
```

如果您使用的是 Mac OS 钥匙串中的密钥，则使用上一步骤中生成的 PEM 版本。否则，请使用以前生成的 OpenSSL 密钥（位于 Windows 上）。

按步骤来，拿到cer文件后发觉无法导出p12，有过来人指点下啊

1. 我先到开发者授权系统，进入Certificates页面后，点击Distribution标签。如下图，下载一个

AppleWWDRCA（Apple World Wide Developer Relations Certification Authority）证书文件到本地，

2. 然后到开发者授权系统证书页面，点击Request Certificate，按照我们之前介绍过的流程上传一个

CSR文件，然后下载一个cer文件，

打开cer文件之后，在钥匙串里面没有发现相应的钥匙。

也无导出p12的提示

这是怎么回事？谁解决过啊？

双击cer文件，钥匙串里面没相应的钥匙？？在certificates分栏里面哦，注意找找看。找到key单击右键就又导出p12文件选项



参考链接：

https://blog.csdn.net/ququ_123/article/details/79863800

https://www.jianshu.com/p/ef06507269c0

[openssl的证书格式转换](https://www.jianshu.com/p/87e3753c222b)