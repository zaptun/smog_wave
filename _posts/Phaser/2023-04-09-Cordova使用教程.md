---
layout: post
filename: 2023-04-09-Cordova使用教程
title: Cordova使用教程
date: 2023-04-09 11:14:29 +0800
categories: Cordova
tags: Cordova
---


# Cordova 使用教程

## 安装 Cordova

在开始使用 Cordova 之前，需要先安装 Cordova。你可以在终端或命令行中输入以下命令来安装 Cordova：

```
npm install -g cordova
```

## 创建 Cordova 项目

在终端或命令行中，进入到你想要创建 Cordova 项目的目录，然后运行以下命令来创建 Cordova 项目：

```
cordova create myapp com.example.myapp MyApp
```

其中，myapp 是项目的名称，com.example.myapp 是项目的 ID，MyApp 是应用程序的名称。

## 添加平台

在创建 Cordova 项目后，需要为项目添加目标平台，例如 iOS、Android 等。在终端或命令行中，进入到 Cordova 项目的根目录，然后运行以下命令来添加平台：

```
cordova platform add ios android
```

其中，ios 是目标平台的名称。

## 编写应用程序代码

Cordova 应用程序使用 HTML、CSS 和 JavaScript 编写。你可以在 www 目录下编写应用程序代码，包括 HTML 页面、CSS 样式和 JavaScript 脚本等。

运行应用程序
在终端或命令行中，进入到 Cordova 项目的根目录，然后运行以下命令来在模拟器或真实设备上运行应用程序：

```
cordova run ios
```

其中，ios 是目标平台的名称。在运行应用程序之前，确保已经连接了模拟器或真实设备。

## 打包应用程序

当应用程序开发完成后，需要将应用程序打包成可发布的文件。在终端或命令行中，进入到 Cordova 项目的根目录，然后运行以下命令来打包应用程序：

```
cordova build ios
```

其中，ios 是目标平台的名称。在打包应用程序之前，需要确保已经为应用程序签名。


## 哪里配置APP图标

### 配置IOS APP图标
要修改 Cordova iOS 平台的应用程序图标，可以按照以下步骤进行操作：

1. 在你的 Cordova 项目的根目录下，找到 platforms/ios/ 目录，进入该目录。
2. 在 platforms/ios/ 目录下，找到 YourAppName/ 目录，进入该目录。
3. 在 YourAppName/ 目录下，找到 Images.xcassets 目录，进入该目录。
4. 在 Images.xcassets 目录下，找到 AppIcon.appiconset 目录，进入该目录。
5. 在 AppIcon.appiconset 目录下，将对应尺寸的图标替换为你的应用程序图标。你需要使用 PNG 格式的图标，并将它们命名为对应的文件名。
6. 在终端或命令行中，进入到 Cordova 项目的根目录，然后运行以下命令来重新构建应用程序：

```
cordova build ios
```

7. 构建完成后，使用 Xcode 打开 Cordova 项目的 iOS 项目文件（platforms/ios/YourAppName.xcodeproj），然后在 Xcode 中运行应用程序。

应用程序的图标已经被更新为你所替换的图标了。

注意：如果你在 Cordova 项目中使用了其他插件，可能需要根据插件的文档或说明来修改应用程序图标。

### 批量生成图标

1. 查看目前安装插件
cordova plugin ls

2. 让项目支持icon和splash可配置
cordova plugin add cordova-plugin-splashscreen
文档：https://www.npmjs.com/package/cordova-plugin-splashscreen


3. 安装自动生成iocn插件
```
npm install cordova-icon -D
#### 自动生成icon 在项目根目录执行, 自动修改对应平台icon文件
npx cordova-icon --config=config.xml --icon=./resources/icon.png
```

4. 安装自动生成splash插件

```
npm add resources-generator -D
# 自动生成splash 在项目根目录执行, resources-generator 也支持生成icon,但是生成出来质量有问题不用
# npx resources-generator --platform=ios --type=icon --source="./resources/icon.png"
npx resources-generator --platform=ios --type=splash --source="./resources/splash.png"
```

5. 修改根目录配置文件 config.xml

```xml
<platform name="android">
    <allow-intent href="market:*" />
    <!-- <icon density="ldpi" src="res/icons/android/icon-36-ldpi.png" />
    <icon density="mdpi" src="res/icons/android/icon-48-mdpi.png" />
    <icon density="hdpi" src="res/icons/android/icon-72-hdpi.png" />
    <icon density="xhdpi" src="res/icons/android/icon-96-xhdpi.png" />
    <icon density="xxhdpi" src="res/icons/android/icon-144-xxhdpi.png" />
    <icon density="xxxhdpi" src="res/icons/android/icon-192-xxxhdpi.png" /> -->
    <splash density="land-hdpi" src="res/screens/android/screen-hdpi-landscape.9.png" />
    <splash density="land-ldpi" src="res/screens/android/screen-ldpi-landscape.9.png" />
    <splash density="land-mdpi" src="res/screens/android/screen-mdpi-landscape.9.png" />
    <splash density="land-xhdpi" src="res/screens/android/screen-xhdpi-landscape.9.png" />
    <splash density="land-xxhdpi" src="res/screens/android/screen-xxhdpi-landscape.9.png" />
    <splash density="land-xxxhdpi" src="res/screens/android/screen-xxxhdpi-landscape.9.png" />
    <splash density="port-hdpi" src="res/screens/android/screen-hdpi-portrait.9.png" />
    <splash density="port-ldpi" src="res/screens/android/screen-ldpi-portrait.9.png" />
    <splash density="port-mdpi" src="res/screens/android/screen-mdpi-portrait.9.png" />
    <splash density="port-xhdpi" src="res/screens/android/screen-xhdpi-portrait.9.png" />
    <splash density="port-xxhdpi" src="res/screens/android/screen-xxhdpi-portrait.9.png" />
    <splash density="port-xxxhdpi" src="res/screens/android/screen-xxxhdpi-portrait.9.png" />
</platform>
<preference name="SplashMaintainAspectRatio" value="false" />

<!-- 禁用启动页面 -->
<!-- <preference name="SplashScreenDelay" value="0"/> -->

<!-- IOS 禁用启动页面 -->
<preference name="FadeSplashScreenDuration" value="0"/>

<!-- 自动隐藏启动页面AutoHideSplashScreen（默认为: true） -->
<preference name="AutoHideSplashScreen" value="true" />

<!-- 显示启动页面的时间长度SplashScreenDelay(默认为: 3000) -->
<preference name="SplashScreenDelay" value="3000" />

<!-- 是否显示淡入淡出效果FadeSplashScreen(默认为: true) -->
<preference name="FadeSplashScreen" value="true"/>

<!-- 淡入淡出效果的执行时间长度FadeSplashScreenDuration(默认为: 500) -->
<preference name="FadeSplashScreenDuration" value="750"/>

<!-- 启动页面是否允许旋转（默认为: true） -->
<preference name="ShowSplashScreenSpinner" value="false"/>

<platform name="ios">
    <allow-intent href="itms:*" />
    <allow-intent href="itms-apps:*" />
    <!-- <icon src="res/icons/ios/icon-60@3x.png" width="180" height="180" />
    <icon src="res/icons/ios/icon-60.png" width="60" height="60" />
    <icon src="res/icons/ios/icon-60@2x.png" width="120" height="120" />
    <icon src="res/icons/ios/icon-76.png" width="76" height="76" />
    <icon src="res/icons/ios/icon-76@2x.png" width="152" height="152" />
    <icon src="res/icons/ios/icon-40.png" width="40" height="40" />
    <icon src="res/icons/ios/icon-40@2x.png" width="80" height="80" />
    <icon src="res/icons/ios/icon.png" width="57" height="57" />
    <icon src="res/icons/ios/icon@2x.png" width="114" height="114" />
    <icon src="res/icons/ios/icon-72.png" width="72" height="72"/>
    <icon src="res/icons/ios/icon-72@2x.png" width="144" height="144"/>
    <icon src="res/icons/ios/icon-167.png" width="167" height="167"/>
    <icon src="res/icons/ios/icon-small.png" width="29" height="29"/>
    <icon src="res/icons/ios/icon-small@2x.png" width="58" height="58"/>
    <icon src="res/icons/ios/icon-small@3x.png" width="87" height="87"/>
    <icon src="res/icons/ios/icon-50.png" width="50" height="50"/>
    <icon src="res/icons/ios/icon-50@2x.png" width="100" height="100" />
    <icon src="res/icons/ios/icon-83.5@2x.png" width="167" height="167"/>
    <icon src="res/icons/ios/icon-20.png" width="20" height="20"/>
    <icon src="res/icons/ios/icon-24@2.png" width="48" height="48"/>
    <icon src="res/icons/ios/icon-27.5@2.png" width="55" height="55"/>
    <icon src="res/icons/ios/icon-86@2.png" width="172" height="172"/>
    <icon src="res/icons/ios/icon-98@2.png" width="196" height="196"/>
    <icon src="res/icons/ios/icon-1024.png" width="1024" height="1024"/> -->
    <splash src="res/screens/ios/Default@2x~universal~anyany.png" />
    <splash src="res/screens/ios/Default@2x~universal~comany.png" />
    <splash src="res/screens/ios/Default@2x~universal~comcom.png" />
    <splash src="res/screens/ios/Default@3x~universal~anyany.png" />
    <splash src="res/screens/ios/Default@3x~universal~anycom.png" />
    <splash src="res/screens/ios/Default@3x~universal~comany.png" />
</platform>
```

6. 插件还可以通过js代码调用，提供有以下两个方法：
* navigator.splashscreen.hide();//隐藏启动页面
* navigator.splashscreen.show();//显示启动页面

7. 最后您可以使用以下命令构建并运行 iOS 应用程序，验证是否起效

```
cordova build ios
cordova run ios
```

### 手动修改 Android APP图标

要修改 Cordova Android 平台的应用程序图标，可以按照以下步骤进行操作：

1. 在你的 Cordova 项目的根目录下，找到 platforms/android/app/src/main/res/ 目录，进入该目录。
2. 在 res 目录下，找到对应尺寸的图标文件夹（例如 mipmap-hdpi、mipmap-mdpi、mipmap-xhdpi、mipmap-xxhdpi 和 mipmap-xxxhdpi），然后将对应尺寸的图标替换为你的应用程序图标。你需要使用 PNG 格式的图标，并将它们命名为对应的文件名。
3. 在终端或命令行中，进入到 Cordova 项目的根目录，然后运行以下命令来重新构建应用程序：

```
cordova build android
```

4. 构建完成后，你可以在 platforms/android/app/build/outputs/apk/ 目录下找到 APK 文件，这是你的应用程序文件。

注意：如果你在 Cordova 项目中使用了其他插件，可能需要根据插件的文档或说明来修改应用程序图标。


## 哪里修改html

要修改 Cordova 项目中的 HTML 文件，可以按照以下步骤进行操作：

1. 在你的 Cordova 项目的根目录下，找到 www 目录，进入该目录。
2. 在 www 目录下，你可以看到 index.html 文件以及其他的 HTML、CSS 和 JavaScript 文件。你可以使用文本编辑器来编辑这些文件。
3. 修改 HTML 文件后，保存文件。
4. 如果你已经在终端或命令行中进入了 Cordova 项目的根目录，可以使用以下命令来重新构建应用程序：

```
cordova build
```

5. 构建完成后，你可以在 platforms 目录下找到相应平台的应用程序文件，例如 iOS 平台下的 .app 文件或 Android 平台下的 .apk 文件。

注意：如果你在 Cordova 项目中使用了其他插件，可能需要根据插件的文档或说明来修改 HTML 文件。

## 在开发时进行热更新

`cordova-plugin-livereload`：这是一个 Cordova 插件，它可以将应用程序连接到 LiveReload 服务器，并在修改文件时自动刷新应用程序。你可以在应用程序中使用 LiveReload 的功能，例如 CSS 注入、文件同步和浏览器自动刷新等。

要使用 cordova-plugin-livereload 进行实时重新加载，请按照以下步骤操作：

安装 cordova-plugin-livereload 插件：

```
cordova plugin add cordova-plugin-livereload
```

启动 livereload 服务：

```
cordova run ios --livereload
```

连接设备或模拟器到本地网络中（确保它们可以访问开发机的 IP 地址）。

在应用程序的 index.html 中插入以下脚本：

```
<script src="http://<your_ip_address>:<port>/cordova.js"></script>
<script src="http://<your_ip_address>:<port>/livereload.js"></script>
```

其中 <your_ip_address> 是你的开发机 IP 地址，<port> 是 livereload 服务的端口号（默认为 35729）。

现在，你可以在本地代码编辑器中修改应用程序代码，并在实时重新加载的情况下查看更改。如果你需要手动刷新页面，请在浏览器中打开以下地址：http://<your_ip_address>:<port>/livereload。

请注意，cordova-plugin-livereload 仅在开发模式下使用，不应在生产环境中使用。此外，该插件有一些局限性和已知问题，如无法在某些设备和环境中正常工作，或者可能会导致应用程序崩溃等问题。因此，请在使用前仔细阅读官方文档，并谨慎测试和部署。

要更改 cordova-plugin-livereload 插件的端口号并使用 localhost 而不是 IP 地址，请按照以下步骤操作：

在应用程序的 config.xml 文件中添加以下配置：

```
<plugin name="cordova-plugin-livereload" version="x.x.x">
    <param name="port" value="xxxx" />
    <param name="host" value="localhost" />
</plugin>
```

其中，将 x.x.x 替换为 cordova-plugin-livereload 插件的版本号，将 xxxx 替换为你想要使用的端口号。

启动应用程序时，将 -- --livereload-url=http://localhost:xxxx 选项添加到 cordova run 命令中，其中 xxxx 是你在上一步中指定的端口号：

```
cordova run android -- --livereload-url=http://localhost:xxxx
```

现在，你可以在本地代码编辑器中修改应用程序代码，并在实时重新加载的情况下查看更改。如果你需要手动刷新页面，请在浏览器中打开以下地址：http://localhost:xxxx。

请注意，如果你使用 localhost 而不是 IP 地址，可能会导致一些安全性问题，如跨站请求伪造（CSRF）攻击等。因此，建议在生产环境中仅使用 IP 地址。

## 发布时移除热更新

如果你想在开发中使用 cordova-plugin-livereload 插件，但在发布时不包含它，可以在应用程序的 config.xml 文件中使用 hook 钩子和 cordova-plugin-advanced-build 插件来实现。

以下是一些步骤：

1. 安装 cordova-plugin-advanced-build 插件：

```
cordova plugin add cordova-plugin-advanced-build
```

2. 在应用程序的 config.xml 文件中添加以下配置：

```
<hook type="before_prepare" src="scripts/remove-livereload.js" />
<plugin name="cordova-plugin-advanced-build" version="x.x.x" />
```

其中，将 x.x.x 替换为 cordova-plugin-advanced-build 插件的版本号。

3. 创建一个名为 remove-livereload.js 的文件，并将以下代码添加到该文件中：

```JavaScript
module.exports = function (ctx) {
    // 仅在发布版本中删除 cordova-plugin-livereload 插件
    if (ctx.opts.options.release) {
        var fs = ctx.requireCordovaModule('fs');
        var path = ctx.requireCordovaModule('path');

        var configPath = path.join(ctx.opts.projectRoot, 'config.xml');
        var configContent = fs.readFileSync(configPath, 'utf8');

        if (configContent.indexOf('cordova-plugin-livereload') !== -1) {
            var newConfigContent = configContent.replace(/<plugin[^>]+>\s*(<param\s+name="livereload-url"[^>]+>\s*<\/param>\s*)?<\/plugin>/gi, '');
            fs.writeFileSync(configPath, newConfigContent, 'utf8');
        }
    }
};
```
这段代码将从应用程序的 config.xml 文件中删除 cordova-plugin-livereload 插件及其相关参数，仅在发布版本中进行操作。

现在，当你运行 cordova build 命令时，如果使用 --release 选项构建应用程序包，则 cordova-plugin-livereload 插件将被自动从应用程序中删除。如果你不使用 --release 选项构建应用程序包，则 cordova-plugin-livereload 插件将保留在应用程序中。

## 怎么升级 Cordova 平台

要升级 Cordova 平台，可以按照以下步骤进行操作：

确认当前 Cordova 平台版本

在终端中进入 Cordova 项目根目录，并运行以下命令：

```
cordova platform ls
```

这会列出当前 Cordova 项目中安装的所有平台及其版本号。

安装最新版本的 Cordova 平台

运行以下命令来安装最新版本的 Cordova 平台：

```
cordova platform update <platform>
```

其中 <platform> 是要升级的平台名称，例如 ios 或 android。如果你想升级所有平台，可以省略 <platform> 参数。

确认是否成功升级

再次运行 cordova platform ls 命令，确认已安装最新版本的 Cordova 平台。

请注意，升级 Cordova 平台时可能会出现一些不兼容性问题，特别是如果你正在使用过时的 Cordova 插件或第三方库。在升级之前，请务必备份你的代码，并检查 Cordova 平台和所有插件的兼容性信息。

## Cordova 的清理怎么做

在开发 Cordova 应用程序时，你可能会生成大量的临时文件和构建产物。这些文件可能会占用大量的磁盘空间，而且对于打包和部署应用程序也没有什么帮助。因此，你需要定期对 Cordova 项目进行清理。

Cordova 提供了一个 CLI 命令 cordova clean，用于删除 Cordova 项目中生成的临时文件和构建产物。运行以下命令，即可清理 Cordova 项目：

```
cordova clean
```

这会删除 Cordova 项目中的所有构建目录，并删除所有生成的临时文件，如插件和平台中的 .git 文件夹、.npmignore 文件、.npmrc 文件、.npmignore 文件等。

请注意，清理 Cordova 项目会删除所有生成的构建产物，因此你可能需要重新构建应用程序。在清理之前，请务必备份 Cordova 项目中的重要文件。