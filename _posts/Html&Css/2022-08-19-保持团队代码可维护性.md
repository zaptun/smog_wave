---
layout: post
filename: 2022-08-19-保持团队代码可维护性
title: 保持团队代码可维护性
date: 2022-08-19 11:15:58 +0800
categories: 可维护性
tags: 可维护性
---


如何保持代码的可维护性？

目前常用的工具 eslint、prettier、husky、lint-staged

- prettier: 统一规范,约束格式,保持代码格式的一致性
- eslint: 检查代码, 提前发现潜在的bug或错误
- husky: 利用git hooks完成自动化检测修复问题
- lint-Staged: 在提交之前检测代码，以保持生产代码的干净



## 1. eslint

eslint 可以对代码进行约束规范，如果代码不符合规范则会在下面呈现一条~~~~ 红色的波浪线, 经常和 prettier 结合使用。

**安装**

```javascript
npm i eslint -D
```

**配置**

在根目录新建 `.eslintrc.js` 配置文件，内容如下

```javascript
module.exports = {
    "env": {
        "browser": true,
        "es2021": true
    },
    "extends": "eslint:recommended",
    "parserOptions": {
        "ecmaVersion": "latest",
        "sourceType": "module"
    },
    "rules": {
        "indent": ["warn", "tab"],
        "quotes": ["error", "single"],
        "semi": ["error", "always"]
        ...
    },
    "extends": [
      ...,
      "prettier"
    ],
}
```

## 2. prettier

prettier 工具可以在代码保存时进行格式化与检查, 配合eslint做代码格式检查, 并自动修复不符合规范的格式。

**安装**

```javascript
npm i prettier eslint-config-prettier -D
```

**配置**

在项目根目录新建 .prettierrc 配置文件，内容如下:

```javascript
{
    "tabWidth": 4, // 保存时为 4 个空格并以 tab 格式
    "singleQuote": false, // 保存时为双引号"useTabs": true,
    "printWidth": 80,
    "semi": true,
    "trailingComma": "es5",
    "jsxSingleQuote": true,
    ...
}
```

## 3. husky

在 Git 中也存在一些钩子，其中较常用的有 pre-push、pre-commit ，其中 pre-commit 钩子会在 commit 前触发，pre-push 会在 push 前触发。（提示：所有钩子默认情况下是禁用的）

这些钩子可以用来干嘛？

比方我们可以利用pre-commit 钩子在 commit 时对代码先进行 eslint 检查，如果不合格就不给 commit，
不过使用 git 钩子稍微麻烦，于是就有了 husky ，它能让我们使用 git 钩子变得更加容易。

**安装**
```javascript
npm i hustky -D
npx husky install
npx husky add .husky/pre-commit
```


## 4. lint-staged

lint-staged 能让上面这些插件只扫描暂存区的文件而不是全盘扫描;

**安装**

```javascript
npm i lint-staged -D
```

在 package.json 新增 lint-staged 选项

```javascript
"scripts": {
    ...
},
"lint-staged": {
  "src/**/*.{js,jsx,ts,tsx,json,css,scss,md}": [
    "eslint --fix"
  ]
},
```


## 5. mrm

mrm 是一个自动化工具

它将根据 package.json 依赖项中的代码质量工具来安装和配置 husky 和 lint-staged，因此请确保在此之前安装并配置所有代码质量工具，如 Prettier 和 ESlint

安装和初始化

```javascript
npm i mrm -D --registry=https://registry.npm.taobao.org
npx mrm lint-staged
```


## API文档

- [Prettier Docs](https://prettier.io/)
- [ESLint Docs](https://eslint.org/)
- [Husky Docs](https://typicode.github.io/husky/#/)
- [Lint-Staged Docs](https://github.com/okonet/lint-staged)
- [Automating Code Checks and Tests with Git Hooks](https://www.antstack.io/blog/adding-git-hooks-to-your-project/)