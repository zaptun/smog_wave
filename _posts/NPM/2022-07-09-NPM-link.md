---
layout: post
filename: 2022-07-09-NPM-link
title: NPM-link
date: 2022-07-09 12:09:48 +0800
categories: NPM
tags: npm-link
---



### 如何使用npm-link

**创建两个文件夹, 分别是 `npm-sum` 和 `npm-example` 并且执行 `npm i -y` 初始化**

```bash
mkdir npm-sum
mkdir npm-example
cd npm-sum & npm i-y
cd npm-example & npm i -y
```

**在 npm-sum 文件夹中创建文件 `index.js` 并且编写一些代码, 如:**

```typescript
const sum = (...args) => {
  return args.reduce((prev, next) => prev + next, 0);
}

module.exports = sum;
```

**在 npm-example 文件夹中同样创建一个用来测试引入的文件 index.js, 并且引入 npm-sum 包进行测试**

```typescript
const sum = require('npm-sum');

console.log(sum(1, 2, 3, 4, 5));
```

**如果此时我们执行时, 会报错, 因为本地进行测试开发的包并没有进行发布, 也没有进行安装,那么我们可以通过 npm link 方式将本地开发包链接到全局 node_modules/下**

```bash
cd npm-sum
npm link
cd npm-example
# 注意: 这里的链接 link 指的是在 npm-sum 初始化时对应的 package.json 中的 name, 如果不一致可能是不生效
npm link npm-sum
```

**可以看到将 `npm-sum` 链接到了全局的`node_modules`下**

**然后我们在执行 `node index.js` 时就可以看到打印出来的结果了**

**自动生成一个 `package-lock.json` 文件, 不需要管**

**可以通过 \**[\*\*npm config get prefix\*\*](https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.npmjs.com%2Fmisc%2Fconfig%23global)\** 命令查看全局链接的地址**

### 取消

```bash
# 将当前目录包链接到全局
npm link 

# 查看当前全局的包
npm ls -g

# 将全局的链接的 pkg-name **包移除**
npm remove -g pka-name 

# 将当前项目中软链接的包移除
npm unlink pka-name 
npm link pka-name
```

---- 
## yalc

有的时候npm link会报错，这时候也可以考虑三方 yalc 

### 1. 安装

`npm i yalc -g `


### 2. 发布依赖

在要被依赖的库项目下执行发布操作

`yalc publish`

>此时如果存在npm 生命周期脚本：prepublish、prepare、prepublishOnly、prepack、preyalcpublish，会按此顺序逐一执行。如果存在：postyalcpublish、postpack、publish、postpublish，也会按此顺序逐一执行。
>想要完全禁用脚本执行需要使用
>`yalc publish --no-scripts`

### 3. 更新依赖
此时就已经将依赖发布到本地仓库了。当有新修改的包需要发布时，使用推送命令可以快速的更新所有依赖

`yalc push`

### 4. 添加依赖
进入到需要引入本地依赖的项目执行

`yalc add [my-package]`

参数:
--dev，将依赖添加进dependency中
--pure，不会影响package.json文件
--link，使用link方式引用依赖包，yalc add [my-package] --link
--workspace (or -W)，添加依赖到workspace:协议中

### 5. 项目内更新依赖和移除依赖
yalc update [my-package]
yalc remove [my-package]
// 移除所有依赖并还原 
yalc remove --all
```
```

### 6. 查看本地仓库和清除
```
//要清理不需要的包时
yalc installations show

//删除指定包
yalc installations clean [my-package] 
```