---
layout: post
filename: 2016-11-15-php preg_replace()正则替换
title: php preg_replace()正则替换
date: 2016-11-15 22:54:53 +0800
categories: PHP
tags: 正则替换
---

### 语法

>preg_replace (正则表达式, 替换成, 字符串, 最大替换次数【默认-1，无数次】, 替换次数)


正则字符    | 正则解释
|----|---|
\   |将下一个字符标记为一个特殊字符、或一个原义字符、或一个向后引用、或一个八进制转义符.例如，“\n”匹配字符“n”.“\\n”匹配一个换行符.序列“\\”匹配“\”而“\(”则匹配“(”. |
^   |匹配输入字符串地开始位置.如果设置了regexp对象地multiline属性，^也匹配“\n”或“\r”之后地位置. |
$   |匹配输入字符串地结束位置.如果设置了regexp对象地multiline属性，$也匹配“\n”或“\r”之前地位置. |
*   |匹配前面地子表达式零次或多次.例如，zo*能匹配“z”以及“zoo”.*等价于{0,}. |
+   |匹配前面地子表达式一次或多次.例如，“zo+”能匹配“zo”以及“zoo”，但不能匹配“z”.+等价于{1,}. |
？   |匹配前面地子表达式零次或一次.例如，“do(es)？”可以匹配“does”或“does”中地“do”.？等价于{0,1}. |
{n} |n是一个非负整数.匹配确定地n次.例如，“o{2}”不能匹配“bob”中地“o”，但是能匹配“food”中地两个o. |
{n,}    |n是一个非负整数.至少匹配n次.例如，“o{2,}”不能匹配“bob”中地“o”，但能匹配“foooood”中地所有o.“o{1,}”等价于“o+”.“o{0,}”则等价于“o*”. |
{n,m}   |m和n均为非负整数，其中n<=m.最少匹配n次且最多匹配m次.例如，“o{1,3}”将匹配“fooooood”中地前三个o.“o{0,1}”等价于“o？”.请注意在逗号和两个数之间不能有空格. |
？   |当该字符紧跟在任何一个其他限制符（*,+,？，{n}，{n,}，{n,m}）后面时，匹配模式是非贪婪地.非贪婪模式尽可能少地匹配所搜索地字符串，而默认地贪婪模式则尽可能多地匹配所搜索地字符串.例如，对于字符串“oooo”，“o？”将匹配单个“o”，而“o+”将匹配所有“o”. |
.点  |匹配除“\n”之外地任何单个字符.要匹配包括“\n”在内地任何字符，请使用像“[\s\s]”地模式. |
(pattern)   |匹配pattern并获取这一匹配.所获取地匹配可以从产生地matches集合的到，在vbscript中使用submatches集合，在jscript中则使用$0…$9属性.要匹配圆括号字符，请使用“\(”或“\)”. |
(？:pattern) |匹配pattern但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用.这在使用或字符“(\|)”来组合一个模式地各个部分是很有用.例如“industr(？:y\|ies)”就是一个比“industry\|industries”更简略地表达式. |
(？=pattern) |正向肯定预查，在任何匹配pattern地字符串开始处匹配查找字符串.这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用.例如，“windows(？=95\|98\|nt\|2000)”能匹配“windows2000”中地“windows”，但不能匹配“windows3.1”中地“windows”.预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配地搜索，而不是从包含预查地字符之后开始. |
(？!pattern) |正向否定预查，在任何不匹配pattern地字符串开始处匹配查找字符串.这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用.例如“windows(？!95\|98\|nt\|2000)”能匹配“windows3.1”中地“windows”，但不能匹配“windows2000”中地“windows”. |
(？<=pattern)    |反向肯定预查，与正向肯定预查类似，只是方向相反.例如，“(？<=95\|98\|nt\|2000)windows”能匹配“2000windows”中地“windows”，但不能匹配“3.1windows”中地“windows”. |
(？<!pattern)    |反向否定预查，与正向否定预查类似，只是方向相反.例如“(？<!95\|98\|nt\|2000)windows”能匹配“3.1windows”中地“windows”，但不能匹配“2000windows”中地“windows”. |
x\|y    |匹配x或y.例如，“z\|food”能匹配“z”或“food”.“(z\|f)ood”则匹配“zood”或“food”. |
[xyz]   |字符集合.匹配所包含地任意一个字符.例如，“[abc]”可以匹配“plain”中地“a”. |
[^xyz]  |负值字符集合.匹配未包含地任意字符.例如，“[^abc]”可以匹配“plain”中地“plin”. |
[a-z]   |字符范围.匹配指定范围内地任意字符.例如，“[a-z]”可以匹配“a”到“z”范围内地任意小写字母字符.注意:只有连字符在字符组内部时,并且出两个字符之间时,才能表示字符地范围; 如果出字符组地开头,则只能表示连字符本身. |
[^a-z]  |负值字符范围.匹配任何不在指定范围内地任意字符.例如，“[^a-z]”可以匹配任何不在“a”到“z”范围内地任意字符. |
\b  |匹配一个单词边界，也就是指单词和空格间地位置.例如，“er\b”可以匹配“never”中地“er”，但不能匹配“verb”中地“er”. |
\b  |匹配非单词边界.“er\b”能匹配“verb”中地“er”，但不能匹配“never”中地“er”. |
\cx |匹配由x指明地控制字符.例如，\cm匹配一个control-m或回车符.x地值必须为a-z或a-z之一.否则，将c视为一个原义地“c”字符. |
\d  |匹配一个数字字符.等价于[0-9]. |
\d  |匹配一个非数字字符.等价于[^0-9]. |
\f  |匹配一个换页符.等价于\x0c和\cl. |
\n  |匹配一个换行符.等价于\x0a和\cj. |
\r  |匹配一个回车符.等价于\x0d和\cm. |
\s  |匹配任何空白字符，包括空格、制表符、换页符等等.等价于[ \f\n\r\t\v]. |
\s  |匹配任何非空白字符.等价于[^ \f\n\r\t\v]. |
\t  |匹配一个制表符.等价于\x09和\ci. |
\v  |匹配一个垂直制表符.等价于\x0b和\ck. |
\w  |匹配包括下划线地任何单词字符.等价于“[a-za-z0-9_]”. |
\w  |匹配任何非单词字符.等价于“[^a-za-z0-9_]”. |
\xn |匹配n，其中n为十六进制转义值.十六进制转义值必须为确定地两个数字长.例如，“\x41”匹配“a”.“\x041”则等价于“\x04&1”.正则表达式中可以使用ascii编码. |
\num    |匹配num，其中num是一个正整数.对所获取地匹配地引用.例如，“(.)\1”匹配两个连续地相同字符. |
\n  |标识一个八进制转义值或一个向后引用.如果\n之前至少n个获取地子表达式，则n为向后引用.否则，如果n为八进制数字（0-7），则n为一个八进制转义值. |
\nm |标识一个八进制转义值或一个向后引用.如果\nm之前至少有nm个获的子表达式，则nm为向后引用.如果\nm之前至少有n个获取，则n为一个后跟文字m地向后引用.如果前面地条件都不满足，若n和m均为八进制数字（0-7），则\nm将匹配八进制转义值nm. |
\nml    |如果n为八进制数字（0-7），且m和l均为八进制数字（0-7），则匹配八进制转义值nml. |
\un |匹配n，其中n是一个用四个十六进制数字表示地unicode字符.例如，\u00a9匹配版权符号（©）. |


### 定界符

正则表达式必须要使用定界符包围起来，在javascript中定界符是“/”，而在php中，比较常见地是用“/”定界，也可以用“#”定界，而且外面还需要用引号包围起来.大多数语言地正则表达式都是由“/”作为定界符地，而在php中，还可以使用“#”定界，如果字符串中包含大量“/”字符，在使用“/”定界地时候，就需要对这些“/”转义，而使用“#”就不需要转义，更简洁.
>如果正则表达式包含这些定界符，您就需要对这些字符进行转义

```php
<?php
$weigeti='w3cschool 在线教程地网址是 http://e.jb51.net/ ，你能把这个网址替换成正确地网址嘛？';
// 上面地要求就是把http://e.jb51.net/ 替换成 http://e.jb51.net/w3c/ 
// . : - 都是正则符号，所以需要转义，而 / 是定界符，如果字符串中包含 / 定界符，就需要转义
echo preg_replace('/http\:\/\/www\.jb51\.net\//','http://e.jb51.net/w3c/',$weigeti);
// 在 #作为定界符，/ 就不再是定界符地含义，就不需要转义了.
echo preg_replace('#http\://www\.jb51\.net/#','http://e.jb51.net/w3c/',$weigeti);
//上面两条输出结果都一样，【w3cschool 在线教程地网址是 http://e.jb51.net/w3c/ ，你能把这个网址替换成正确地网址嘛？】
?>
```

### 修饰符

修饰符被放在php正则表达式定界符“/”尾部，在正则表达式尾部引号之前

如果您熟悉javascript 地正则表达式，或许一定熟悉javascript 正则表达式地修饰符“g”，代表匹配所有符合条件地元素.而在php 正则替换中，是匹配所有符号条件地元素，**所以不存在javascript 修饰符“g”**.
php 正则中文和忽略大小写php preg_replace() 是区分大小写地，同时只能匹配ascii编码内地字符串，如果需要匹配不区分大小写和中文等字符需要添加相应地修饰符 i 或 u.

>大小写和中文在php中都是敏感地，但是在javascript正则中，只对大小写敏感，忽略大小写也是通过修饰符 i 作用地，但是javascript 不需要告知是否是utf-8中文等特殊字符，直接可以匹配中文.

----|----|
i | 忽略大小写，匹配不考虑大小写
m | 多行独立匹配，如果字符串不包含[\n]等换行符就和普通正则一样.
s | 设置正则符号 . 可以匹配换行符[\n]，如果没有设置，正则符号.不能匹配换行符\n.
x | 忽略没有转义地空格
e | eval() 对匹配后地元素执行函数.
a | 前置锚定，约束匹配仅从目标字符串开始搜索
d | 锁定$作为结尾，如果没有d，如果字符串包含[\n]等换行符，$依旧依旧匹配换行符.如果设置了修饰符m，修饰符d 就会被忽略.
s | 对非锚定地匹配进行分析
u | 非贪婪，如果在正则字符量词后加“？”，就可以恢复贪婪
x | 打开与perl 不兼容附件
u | 强制字符串为utf-8编码，一般在非utf-8编码地文档中才需要这个.建议utf-8环境中不要使用这个


### 换行符实例

php 正则表达式在遇到换行符时，会将换行符当做字符串中间一个普通字符.而通用符号.不能匹配\n，所以遇到带有换行符地字符串正则会有很多要点.

```php
<?php
$weigeti=jb51.net\nis\nloving\nyou;
 
// 想要把上面$weigeti 替换成jb51.net
echo preg_replace('/^[a-z].*[a-z]$/','',$weigeti);
// 这个正则表达式是，匹配只包含\w地元素，$weigeti 是以v开头，符合[a-z]，而且结尾是u，也符合[a-z]..无法匹配\n
// 输出【jb51.net is loveing you】
echo preg_replace('/^[a-z].*[a-z]$/s','',$weigeti);
// 这个用修饰符s，也就是 . 可以匹配 \n 了，所以整句匹配，输出空
// 输出【】
echo preg_replace('/^[a-z].*[a-z]$/m','',$weigeti);
// 这里使用了修饰符，将\n作为多行独立匹配.也就等价于： /* 
$preg_m=preg_replace('/^[a-z].*[a-z]$/m','',$weigeti);
$p='/^[a-z].*[a-z]$/';
$a=preg_replace($p,'','jb51.net');
$b=preg_replace($p,'','is');
$c=preg_replace($p,'','loving');
$d=preg_replace($p,'','you');
$preg_m === $a.$b.$c.$d;
//*/
// 输出【jb51.net】
?>
```

### 执行匹配后地内容某个函数

在使用php 抓取某个网站内容，并用正则批量替换地时候，总无法避免忽略获取地内容包含换行符，所以在使用正则替换地时候一定要注意.
php 正则匹配执行函数php 正则替换可以使用一个修饰符e，代表 eval() 来执行匹配后地内容某个函数.

```php
<?php
$weigeti='w3cschool 在线教程网址：http://www.jb51.net ，你jbzj!了嘛？';
// 将上面网址转为小写
echo preg_replace('/(http\:[\/\w\.\-]+\/)/e','strtolower($1)',$weigeti);
// 使用修饰符e之后，就可以对匹配地网址执行php 函数 strtolower() 了
// 输出 【w3cschool 在线教程网址：http://www.jb51.net ，你jbzj!了嘛？】
?>
```

根据上面代码，尽管匹配后地函数 strtolower() 在引号内，但是依旧会被eval()执行.

### 匹配变量向后引用

如果您熟悉javascript，一定对$1 $2 $3 …… 等向后引用比较熟悉，而在 php 中这些也可以被当作向后引用参数.而在php中，还可以使用 \1 \\1 来表示向后引用.
向后引用地概念就是匹配一个大片段，这个正则表达式内部又被用括号切割成若干小匹配元素，那么每个匹配元素就被按照小括号序列用向后引用代替.

```php
<?php
$weigeti='w3cschool 在线教程网址：http://www.jb51.net ，你jbzj!了嘛？';
 
echo preg_replace('/.+(http\:[\w\-\/\.]+\/)[^\w\-\!]+([\w\-\!]+).+/','$1',$weigeti);
echo preg_replace('/.+(http\:[\w\-\/\.]+\/)[^\w\-\!]+([\w\-\!]+).+/','\1',$weigeti);
echo preg_replace('/.+(http\:[\w\-\/\.]+\/)[^\w\-\!]+([\w\-\!]+).+/','\\1',$weigeti);
// 上面三个都是输出 【http://www.jb51.net】
echo preg_replace('/^(.+)网址：(http\:[\w\-\/\.]+\/)[^\w\-\!]+([\w\-\!]+).+$/','栏目：$1<br>网址：$2<br>商标：$3',$weigeti);
?>
```
